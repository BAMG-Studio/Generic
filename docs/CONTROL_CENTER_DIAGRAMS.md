# ForgeTrace Control Center - Visual Diagrams

## System Architecture Diagram

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                              INTERNET / CDN                                  │
└─────────────────────────────────────────────────────────────────────────────┘
                                      │
                    ┌─────────────────┼─────────────────┐
                    │                 │                 │
                    ▼                 ▼                 ▼
        ┌───────────────────┐ ┌──────────────┐ ┌──────────────┐
        │ www.forgetrace.pro│ │app.forgetrace│ │api.forgetrace│
        │  (Marketing Site) │ │     .pro     │ │     .pro     │
        │                   │ │ (Dashboard)  │ │  (Backend)   │
        │  • Landing Page   │ │              │ │              │
        │  • Documentation  │ │  Login       │ │  FastAPI     │
        │  • Pricing        │ │  Gateway     │ │  Server      │
        │  • App Downloads  │ │              │ │              │
        │                   │ │  ┌────────┐  │ │              │
        │  Static Site      │ │  │Client  │  │ │  ┌────────┐  │
        │  (S3+CloudFront)  │ │  │Portal  │  │ │  │Auth    │  │
        │                   │ │  └────────┘  │ │  │Layer   │  │
        │                   │ │              │ │  └────────┘  │
        │                   │ │  ┌────────┐  │ │              │
        │                   │ │  │Mgmt    │  │ │  ┌────────┐  │
        │                   │ │  │Portal  │  │ │  │API     │  │
        │                   │ │  └────────┘  │ │  │Routes  │  │
        │                   │ │              │ │  └────────┘  │
        │                   │ │  React SPA   │ │              │
        │                   │ │  (S3+CF)     │ │  (ECS/EKS)   │
        └───────────────────┘ └──────────────┘ └──────┬───────┘
                                                       │
                                    ┌──────────────────┼──────────────────┐
                                    │                  │                  │
                                    ▼                  ▼                  ▼
                            ┌──────────────┐  ┌──────────────┐  ┌──────────────┐
                            │  PostgreSQL  │  │    Redis     │  │   AWS S3     │
                            │              │  │              │  │              │
                            │  • Users     │  │  • Sessions  │  │  • Reports   │
                            │  • Tenants   │  │  • Cache     │  │  • Artifacts │
                            │  • Tokens    │  │  • Rate      │  │  • Backups   │
                            │  • Audits    │  │    Limits    │  │              │
                            │              │  │              │  │              │
                            │  (RDS)       │  │(ElastiCache) │  │              │
                            └──────────────┘  └──────────────┘  └──────────────┘
```

## Authentication Flow Diagram

### Client Token Authentication

```
┌──────────┐                                              ┌──────────┐
│  Client  │                                              │   API    │
│  User    │                                              │  Server  │
└────┬─────┘                                              └────┬─────┘
     │                                                          │
     │  1. Purchase subscription                               │
     │     (via website)                                       │
     │                                                          │
     │  2. Receive API token                                   │
     │     ftk_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx                │
     │◄─────────────────────────────────────────────────────── │
     │                                                          │
     │  3. Make API request with token                         │
     │     Authorization: Bearer ftk_xxxxx                     │
     ├─────────────────────────────────────────────────────────►
     │                                                          │
     │                                    4. Validate token     │
     │                                       • Check exists     │
     │                                       • Verify active    │
     │                                       • Check scopes     │
     │                                       • Rate limit       │
     │                                                          │
     │  5. Return response                                     │
     │◄─────────────────────────────────────────────────────── │
     │                                                          │
```

### Management Credential Authentication

```
┌──────────┐                                              ┌──────────┐
│Management│                                              │   API    │
│  User    │                                              │  Server  │
└────┬─────┘                                              └────┬─────┘
     │                                                          │
     │  1. Visit app.forgetrace.pro                            │
     │                                                          │
     │  2. Enter email + password                              │
     │     POST /api/v1/auth/login                             │
     ├─────────────────────────────────────────────────────────►
     │                                                          │
     │                                    3. Validate creds    │
     │                                       • Check password   │
     │                                       • Verify active    │
     │                                       • Generate JWT     │
     │                                                          │
     │  4. Return JWT tokens                                   │
     │     { access_token, refresh_token, user }               │
     │◄─────────────────────────────────────────────────────── │
     │                                                          │
     │  5. Store tokens in browser                             │
     │                                                          │
     │  6. Make authenticated requests                         │
     │     Authorization: Bearer eyJ...                        │
     ├─────────────────────────────────────────────────────────►
     │                                                          │
     │                                    7. Validate JWT      │
     │                                       • Verify signature │
     │                                       • Check expiry     │
     │                                       • Check role       │
     │                                                          │
     │  8. Return response                                     │
     │◄─────────────────────────────────────────────────────── │
     │                                                          │
```

## User Journey Diagrams

### Client User Journey

```
┌─────────────────┐
│ Visit Website   │
│ www.forgetrace  │
│      .pro       │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│ View Pricing &  │
│ Select Tier     │
│ (Free/Pro/Ent)  │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│ Purchase        │
│ Subscription    │
│ (Stripe)        │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│ Receive API     │
│ Token via Email │
│ ftk_xxxxx       │
└────────┬────────┘
         │
         ├──────────────────┬──────────────────┐
         │                  │                  │
         ▼                  ▼                  ▼
┌─────────────────┐ ┌─────────────┐ ┌─────────────────┐
│ Use Token in    │ │ Visit App   │ │ Download Mobile │
│ API Calls       │ │ Portal      │ │ App             │
│                 │ │             │ │                 │
│ curl -H "Auth:  │ │ Enter Token │ │ Enter Token     │
│ Bearer ftk_xxx" │ │             │ │                 │
│                 │ │ View Usage  │ │ View Reports    │
│ Submit Audits   │ │ & Reports   │ │ Get Notifs      │
└─────────────────┘ └─────────────┘ └─────────────────┘
```

### Management User Journey

```
┌─────────────────┐
│ Invited by      │
│ Admin or        │
│ Self-Register   │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│ Visit App       │
│ app.forgetrace  │
│      .pro       │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│ Click           │
│ "Management     │
│  Sign In"       │
└────────┬────────┘
         │
         ├──────────────────┬──────────────────┐
         │                  │                  │
         ▼                  ▼                  ▼
┌─────────────────┐ ┌─────────────┐ ┌─────────────────┐
│ Email/Password  │ │ GitHub      │ │ Google          │
│                 │ │ OAuth       │ │ OAuth           │
└────────┬────────┘ └──────┬──────┘ └────────┬────────┘
         │                  │                  │
         └──────────────────┴──────────────────┘
                            │
                            ▼
                   ┌─────────────────┐
                   │ Dashboard       │
                   │ (Role-based)    │
                   └────────┬────────┘
                            │
         ┌──────────────────┼──────────────────┬──────────────────┐
         │                  │                  │                  │
         ▼                  ▼                  ▼                  ▼
┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│ Super Admin │    │Tenant Admin │    │    User     │    │   Viewer    │
│             │    │             │    │             │    │             │
│ • All       │    │ • Org Users │    │ • Own       │    │ • Assigned  │
│   Tenants   │    │ • Org       │    │   Audits    │    │   Audits    │
│ • All Users │    │   Audits    │    │ • Personal  │    │ • Download  │
│ • Platform  │    │ • Tokens    │    │   Tokens    │    │   Reports   │
│   Settings  │    │ • Settings  │    │             │    │             │
└─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘
```

## Data Flow Diagram

### Audit Submission Flow

```
┌──────────┐                                                    ┌──────────┐
│  Client  │                                                    │   API    │
│          │                                                    │  Server  │
└────┬─────┘                                                    └────┬─────┘
     │                                                                │
     │  1. POST /api/v1/audits                                       │
     │     { repository, branch }                                    │
     ├──────────────────────────────────────────────────────────────►│
     │                                                                │
     │                                          2. Validate auth      │
     │                                             & permissions      │
     │                                                                │
     │                                          3. Create audit       │
     │                                             record in DB       │
     │                                                                │
     │  4. Return audit ID                                           │
     │     { id, status: "pending" }                                 │
     │◄──────────────────────────────────────────────────────────────┤
     │                                                                │
     │                                          5. Queue audit job    │
     │                                             (async worker)     │
     │                                                                │
     │                                          6. Clone repo         │
     │                                             Run ForgeTrace     │
     │                                             Generate report    │
     │                                                                │
     │                                          7. Upload to S3       │
     │                                             Update DB status   │
     │                                                                │
     │  8. Poll for status                                           │
     │     GET /api/v1/audits/{id}                                   │
     ├──────────────────────────────────────────────────────────────►│
     │                                                                │
     │  9. Return status                                             │
     │     { status: "completed", result_url }                       │
     │◄──────────────────────────────────────────────────────────────┤
     │                                                                │
     │  10. Download report                                          │
     │      GET /api/v1/audits/{id}/report                           │
     ├──────────────────────────────────────────────────────────────►│
     │                                                                │
     │                                          11. Generate signed   │
     │                                              S3 URL            │
     │                                                                │
     │  12. Return report                                            │
     │◄──────────────────────────────────────────────────────────────┤
     │                                                                │
```

## Permission Matrix

```
┌─────────────────┬──────────────┬──────────────┬──────────────┬──────────────┐
│   Permission    │ Super Admin  │ Tenant Admin │     User     │    Viewer    │
├─────────────────┼──────────────┼──────────────┼──────────────┼──────────────┤
│ View All        │      ✓       │      ✗       │      ✗       │      ✗       │
│ Tenants         │              │              │              │              │
├─────────────────┼──────────────┼──────────────┼──────────────┼──────────────┤
│ Manage All      │      ✓       │      ✗       │      ✗       │      ✗       │
│ Tenants         │              │              │              │              │
├─────────────────┼──────────────┼──────────────┼──────────────┼──────────────┤
│ View Org        │      ✓       │      ✓       │      ✗       │      ✗       │
│ Users           │              │              │              │              │
├─────────────────┼──────────────┼──────────────┼──────────────┼──────────────┤
│ Manage Org      │      ✓       │      ✓       │      ✗       │      ✗       │
│ Users           │              │              │              │              │
├─────────────────┼──────────────┼──────────────┼──────────────┼──────────────┤
│ View All        │      ✓       │      ✓       │      ✗       │      ✗       │
│ Org Audits      │              │              │              │              │
├─────────────────┼──────────────┼──────────────┼──────────────┼──────────────┤
│ View Own        │      ✓       │      ✓       │      ✓       │      ✓       │
│ Audits          │              │              │              │              │
├─────────────────┼──────────────┼──────────────┼──────────────┼──────────────┤
│ Submit          │      ✓       │      ✓       │      ✓       │      ✗       │
│ Audits          │              │              │              │              │
├─────────────────┼──────────────┼──────────────┼──────────────┼──────────────┤
│ Delete          │      ✓       │      ✓       │      ✗       │      ✗       │
│ Audits          │              │              │              │              │
├─────────────────┼──────────────┼──────────────┼──────────────┼──────────────┤
│ View All        │      ✓       │      ✓       │      ✗       │      ✗       │
│ Org Tokens      │              │              │              │              │
├─────────────────┼──────────────┼──────────────┼──────────────┼──────────────┤
│ Create          │      ✓       │      ✓       │      ✓       │      ✗       │
│ Tokens          │              │              │              │              │
├─────────────────┼──────────────┼──────────────┼──────────────┼──────────────┤
│ Revoke          │      ✓       │      ✓       │      ✓*      │      ✗       │
│ Tokens          │              │              │   (own only) │              │
├─────────────────┼──────────────┼──────────────┼──────────────┼──────────────┤
│ View            │      ✓       │      ✓       │      ✓       │      ✓       │
│ Reports         │              │              │              │              │
├─────────────────┼──────────────┼──────────────┼──────────────┼──────────────┤
│ Export          │      ✓       │      ✓       │      ✓       │      ✓       │
│ Reports         │              │              │              │              │
├─────────────────┼──────────────┼──────────────┼──────────────┼──────────────┤
│ Platform        │      ✓       │      ✗       │      ✗       │      ✗       │
│ Settings        │              │              │              │              │
├─────────────────┼──────────────┼──────────────┼──────────────┼──────────────┤
│ Org             │      ✓       │      ✓       │      ✗       │      ✗       │
│ Settings        │              │              │              │              │
├─────────────────┼──────────────┼──────────────┼──────────────┼──────────────┤
│ View            │      ✓       │      ✓       │      ✗       │      ✗       │
│ Analytics       │              │              │              │              │
└─────────────────┴──────────────┴──────────────┴──────────────┴──────────────┘
```

## Token Tier Comparison

```
┌─────────────────┬──────────────┬──────────────┬──────────────┐
│    Feature      │     Free     │ Professional │  Enterprise  │
├─────────────────┼──────────────┼──────────────┼──────────────┤
│ Files/Month     │    1,000     │   50,000     │   Custom     │
├─────────────────┼──────────────┼──────────────┼──────────────┤
│ Requests/Min    │      60      │     300      │   Custom     │
├─────────────────┼──────────────┼──────────────┼──────────────┤
│ Audit History   │   30 days    │   1 year     │  Unlimited   │
├─────────────────┼──────────────┼──────────────┼──────────────┤
│ API Tokens      │      1       │      5       │   Unlimited  │
├─────────────────┼──────────────┼──────────────┼──────────────┤
│ Webhooks        │      ✗       │      ✓       │      ✓       │
├─────────────────┼──────────────┼──────────────┼──────────────┤
│ Priority Queue  │      ✗       │      ✓       │      ✓       │
├─────────────────┼──────────────┼──────────────┼──────────────┤
│ SLA             │     None     │    99.5%     │    Custom    │
├─────────────────┼──────────────┼──────────────┼──────────────┤
│ Support         │  Community   │   Priority   │  Dedicated   │
├─────────────────┼──────────────┼──────────────┼──────────────┤
│ White-label     │      ✗       │      ✗       │      ✓       │
├─────────────────┼──────────────┼──────────────┼──────────────┤
│ SSO             │      ✗       │      ✗       │      ✓       │
├─────────────────┼──────────────┼──────────────┼──────────────┤
│ Custom Reports  │      ✗       │      ✗       │      ✓       │
├─────────────────┼──────────────┼──────────────┼──────────────┤
│ Scopes          │   read:*     │  read:*,     │     All      │
│                 │              │  write:*     │              │
└─────────────────┴──────────────┴──────────────┴──────────────┘
```

## Deployment Architecture

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                              AWS CLOUD                                       │
│                                                                              │
│  ┌────────────────────────────────────────────────────────────────────────┐ │
│  │                         Route 53 (DNS)                                  │ │
│  │  • www.forgetrace.pro → CloudFront                                     │ │
│  │  • app.forgetrace.pro → CloudFront                                     │ │
│  │  • api.forgetrace.pro → ALB                                            │ │
│  └────────────────────────────────────────────────────────────────────────┘ │
│                                                                              │
│  ┌────────────────────────────────────────────────────────────────────────┐ │
│  │                      CloudFront (CDN)                                   │ │
│  │  ┌──────────────────┐         ┌──────────────────┐                    │ │
│  │  │ www.forgetrace   │         │ app.forgetrace   │                    │ │
│  │  │      .pro        │         │      .pro        │                    │ │
│  │  │                  │         │                  │                    │ │
│  │  │   S3 Bucket      │         │   S3 Bucket      │                    │ │
│  │  │  (Static Site)   │         │  (React SPA)     │                    │ │
│  │  └──────────────────┘         └──────────────────┘                    │ │
│  └────────────────────────────────────────────────────────────────────────┘ │
│                                                                              │
│  ┌────────────────────────────────────────────────────────────────────────┐ │
│  │              Application Load Balancer (ALB)                            │ │
│  │                   api.forgetrace.pro                                    │ │
│  └────────────────────────────────────────────────────────────────────────┘ │
│                                    │                                         │
│  ┌─────────────────────────────────┴──────────────────────────────────────┐ │
│  │                    ECS Fargate / EKS                                    │ │
│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐                │ │
│  │  │   FastAPI    │  │   FastAPI    │  │   FastAPI    │                │ │
│  │  │   Container  │  │   Container  │  │   Container  │                │ │
│  │  │              │  │              │  │              │                │ │
│  │  │  • Auth      │  │  • Auth      │  │  • Auth      │                │ │
│  │  │  • API       │  │  • API       │  │  • API       │                │ │
│  │  │  • Workers   │  │  • Workers   │  │  • Workers   │                │ │
│  │  └──────────────┘  └──────────────┘  └──────────────┘                │ │
│  │                                                                         │ │
│  │  Auto Scaling: 2-10 instances based on CPU/Memory                      │ │
│  └─────────────────────────────────────────────────────────────────────────┘ │
│                                                                              │
│  ┌────────────────────────────────────────────────────────────────────────┐ │
│  │                         Data Layer                                      │ │
│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐                │ │
│  │  │     RDS      │  │ ElastiCache  │  │      S3      │                │ │
│  │  │  PostgreSQL  │  │    Redis     │  │              │                │ │
│  │  │              │  │              │  │  • Reports   │                │ │
│  │  │  Multi-AZ    │  │  Cluster     │  │  • Artifacts │                │ │
│  │  │  Encrypted   │  │  Mode        │  │  • Backups   │                │ │
│  │  └──────────────┘  └──────────────┘  └──────────────┘                │ │
│  └────────────────────────────────────────────────────────────────────────┘ │
│                                                                              │
│  ┌────────────────────────────────────────────────────────────────────────┐ │
│  │                    Monitoring & Logging                                 │ │
│  │  • CloudWatch Logs                                                      │ │
│  │  • CloudWatch Metrics                                                   │ │
│  │  • X-Ray Tracing                                                        │ │
│  │  • CloudWatch Alarms                                                    │ │
│  └────────────────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────────────┘
```

## Mobile App Architecture

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           Mobile Applications                                │
│                                                                              │
│  ┌────────────────────────────────┐  ┌────────────────────────────────┐   │
│  │         iOS App                │  │        Android App             │   │
│  │                                │  │                                │   │
│  │  ┌──────────────────────────┐  │  │  ┌──────────────────────────┐  │   │
│  │  │   Authentication         │  │  │  │   Authentication         │  │   │
│  │  │  • Token Input           │  │  │  │  • Token Input           │  │   │
│  │  │  • Credential Login      │  │  │  │  • Credential Login      │  │   │
│  │  │  • OAuth (GitHub/Google) │  │  │  │  • OAuth (GitHub/Google) │  │   │
│  │  │  • Biometric Auth        │  │  │  │  • Biometric Auth        │  │   │
│  │  └──────────────────────────┘  │  │  └──────────────────────────┘  │   │
│  │                                │  │                                │   │
│  │  ┌──────────────────────────┐  │  │  ┌──────────────────────────┐  │   │
│  │  │   Features               │  │  │  │   Features               │  │   │
│  │  │  • View Reports          │  │  │  │  • View Reports          │  │   │
│  │  │  • Submit Audits         │  │  │  │  • Submit Audits         │  │   │
│  │  │  • Usage Stats           │  │  │  │  • Usage Stats           │  │   │
│  │  │  • Push Notifications    │  │  │  │  • Push Notifications    │  │   │
│  │  │  • Offline Viewing       │  │  │  │  • Offline Viewing       │  │   │
│  │  └──────────────────────────┘  │  │  └──────────────────────────┘  │   │
│  │                                │  │                                │   │
│  │  Swift / SwiftUI               │  │  Kotlin / Jetpack Compose      │   │
│  └────────────────────────────────┘  └────────────────────────────────┘   │
│                                                                              │
│                                    │                                         │
│                                    ▼                                         │
│                                                                              │
│                    ┌────────────────────────────────┐                       │
│                    │   API Gateway                  │                       │
│                    │   api.forgetrace.pro           │                       │
│                    └────────────────────────────────┘                       │
└─────────────────────────────────────────────────────────────────────────────┘
```

These diagrams provide a visual representation of the ForgeTrace Control Center architecture, authentication flows, user journeys, and deployment structure.
