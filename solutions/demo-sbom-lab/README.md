# Demo: Live SBOM pipeline (SBOM → Scan → S3 → Security Hub)

This folder is a self-contained demo lab you can share in interviews: "Here is my live SBOM pipeline secured with OIDC and Kyverno".

Contents
- `README.md` (this file) — walkthrough and quickstart.
- `scripts/` — small scripts to generate SBOMs, scan, upload, and push findings to Security Hub (placeholders; review before running).
- `.github/workflows/demo-sbom-pipeline.yml` — example GitHub Actions pipeline using OIDC to upload to S3 and demonstrating a Kyverno validation step.
- `COMPLIANCE-EO-14028.md` — compliance mapping (EO 14028 alignment).
- `DELIVERABLES.md` — tangible deliverables and screenshots checklist.
- `assets/screenshots/` — place real screenshots here for interview demos.

High-level flow
1. Generate SBOM for an OCI image or local project using Syft.
2. Scan the SBOM or image using Trivy (or your SCA tool).
3. Store results (SBOM + report) to S3 using GitHub OIDC to assume an AWS role.
4. Convert findings to Security Hub format and import or push them to Security Hub.
5. Use Kyverno policy checks as a gate (example) — run Kyverno CLI locally or in-cluster.

Contract (inputs/outputs)
- Inputs: container image (or directory), AWS OIDC role configured for the repository, Kyverno policies (YAML).
- Outputs: SBOM (JSON/Syft), vulnerability report (Trivy/JSON), S3 objects, Security Hub findings.
- Error modes: missing AWS permissions, missing CLI tools (syft/trivy/aws), invalid OIDC setup.
- Success criteria: generated SBOM, vulnerability scan produced, artifacts stored in S3, optional Security Hub ingestion accepted.

Quickstart (local)
1. Install required CLIs: `syft`, `trivy`, `aws` (v2), `jq`.
2. Make scripts executable: `chmod +x solutions/demo-sbom-lab/scripts/*.sh`.
3. Generate an SBOM:

   ./solutions/demo-sbom-lab/scripts/generate-sbom.sh <image-or-dir> ./output/sbom.json

4. Scan with Trivy:

   ./solutions/demo-sbom-lab/scripts/scan-sbom.sh ./output/sbom.json ./output/scan.json

5. Upload to S3 (requires AWS OIDC or creds):

   ./solutions/demo-sbom-lab/scripts/upload-sbom.sh ./output/sbom.json s3://my-demo-bucket/path/

6. (Optional) Push findings to Security Hub — follow README in `COMPLIANCE-EO-14028.md` for mapping and an example script.

Notes
- The CI workflow uses GitHub OIDC; you'll still need an AWS role that trusts GitHub Actions for your repository. See `demo-sbom-pipeline.yml` for an example IAM trust condition and the `permissions: id-token: write` setting.
- Replace placeholder ARNs and bucket names before running in production.

Testing & Timestamps
--------------------

Run the unit tests locally (recommended inside a virtual environment). From the repository root:

```bash
python -m venv .venv
source .venv/bin/activate
python -m pip install --upgrade pip
pip install -r requirements.txt
pytest -q
```

Timestamp note: the demo converter uses timezone-aware UTC timestamps. Findings generated by `push_securityhub` include ISO timestamps that end with `Z` (UTC). This avoids warnings about naive datetimes and is intended to match AWS timestamps expectations.

Where to put screenshots
- Add Security Hub / CI screenshots to `solutions/demo-sbom-lab/assets/screenshots/` with descriptive names.

Next steps
- Add real screenshots and export a short video demo.
- If you'd like, I can implement a working end-to-end demo using a free-tier AWS account or a mocked local stack (S3-compatible) and a tiny container image — tell me which option you prefer.
